<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>3D Posing Tool</title>
  <style>
    body { margin: 0; overflow: hidden; }
    canvas { display: block; }
  </style>
</head>
<body>
<script type="module">
  import * as THREE from "./node_modules/three/build/three.module.js";
  import { OrbitControls } from "./node_modules/three/examples/jsm/controls/OrbitControls.js";
  import { GUI } from './node_modules/three/examples/jsm/libs/dat.gui.module.js';

  let scene, camera, renderer, controls, light, gui;
  let human = {};
  
  function init() {
    // Scene setup
    scene = new THREE.Scene();
    camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 1000);
    camera.position.set(0, 5, 15);

    renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.shadowMap.enabled = true;
    document.body.appendChild(renderer.domElement);

    controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;

    // Lighting
    light = new THREE.DirectionalLight(0xffffff, 1);
    light.position.set(10, 10, 10);
    light.castShadow = true;
    scene.add(light);

    const ambientLight = new THREE.AmbientLight(0x404040, 1);
    scene.add(ambientLight);

    // Create ground plane
    const ground = new THREE.Mesh(
      new THREE.PlaneGeometry(20, 20),
      new THREE.ShadowMaterial({ opacity: 0.3 })
    );
    ground.rotation.x = -Math.PI / 2;
    ground.receiveShadow = true;
    scene.add(ground);

    // Create a simple human model
    createHumanModel();

    // Add GUI for controlling joints
    setupGUI();

    window.addEventListener('resize', onWindowResize);
    animate();
  }

  // Create a simple human figure using boxes and spheres
  function createHumanModel() {
    const material = new THREE.MeshStandardMaterial({ color: 0x00aaff });

    // Torso
    const torso = new THREE.Mesh(new THREE.BoxGeometry(1, 3, 1), material);
    torso.castShadow = true;
    scene.add(torso);
    human.torso = torso;

    // Head
    const head = new THREE.Mesh(new THREE.SphereGeometry(0.5, 32, 32), material);
    head.position.set(0, 2.25, 0);
    torso.add(head);
    human.head = head;

    // Arms
    const armMaterial = new THREE.MeshStandardMaterial({ color: 0xffaa00 });
    human.leftArm = createLimb({ x: -1.25, y: 1.25 }, armMaterial);
    human.rightArm = createLimb({ x: 1.25, y: 1.25 }, armMaterial);
    torso.add(human.leftArm.group);
    torso.add(human.rightArm.group);

    // Legs
    const legMaterial = new THREE.MeshStandardMaterial({ color: 0xaa00ff });
    human.leftLeg = createLimb({ x: -0.5, y: -1.75 }, legMaterial);
    human.rightLeg = createLimb({ x: 0.5, y: -1.75 }, legMaterial);
    torso.add(human.leftLeg.group);
    torso.add(human.rightLeg.group);
  }

  // Helper to create limbs (for arms and legs)
  function createLimb(position, material) {
    const group = new THREE.Group();

    const upper = new THREE.Mesh(new THREE.BoxGeometry(0.5, 1.5, 0.5), material);
    upper.castShadow = true;
    upper.position.set(position.x, position.y, 0);
    group.add(upper);

    const joint = new THREE.Mesh(new THREE.SphereGeometry(0.25, 16, 16), material);
    joint.position.set(0, -0.75, 0);
    upper.add(joint);

    const lower = new THREE.Mesh(new THREE.BoxGeometry(0.5, 1.5, 0.5), material);
    lower.position.set(0, -1.5, 0);
    joint.add(lower);

    return { group, upper, lower, joint };
  }

  // Set up GUI controls for rotating limbs and head
  function setupGUI() {
    gui = new GUI();

    const torsoFolder = gui.addFolder('Torso');
    torsoFolder.add(human.torso.rotation, 'y', -Math.PI, Math.PI).name('Rotate Y');

    const headFolder = gui.addFolder('Head');
    headFolder.add(human.head.rotation, 'y', -Math.PI / 2, Math.PI / 2).name('Rotate Y');
    headFolder.add(human.head.rotation, 'x', -Math.PI / 4, Math.PI / 4).name('Rotate X');

    const leftArmFolder = gui.addFolder('Left Arm');
    leftArmFolder.add(human.leftArm.upper.rotation, 'z', -Math.PI / 2, Math.PI / 2).name('Upper Rotate Z');
    leftArmFolder.add(human.leftArm.lower.rotation, 'z', -Math.PI / 2, Math.PI / 2).name('Lower Rotate Z');

    const rightArmFolder = gui.addFolder('Right Arm');
    rightArmFolder.add(human.rightArm.upper.rotation, 'z', -Math.PI / 2, Math.PI / 2).name('Upper Rotate Z');
    rightArmFolder.add(human.rightArm.lower.rotation, 'z', -Math.PI / 2, Math.PI / 2).name('Lower Rotate Z');

    const leftLegFolder = gui.addFolder('Left Leg');
    leftLegFolder.add(human.leftLeg.upper.rotation, 'z', -Math.PI / 2, Math.PI / 2).name('Upper Rotate Z');
    leftLegFolder.add(human.leftLeg.lower.rotation, 'z', -Math.PI / 2, Math.PI / 2).name('Lower Rotate Z');

    const rightLegFolder = gui.addFolder('Right Leg');
    rightLegFolder.add(human.rightLeg.upper.rotation, 'z', -Math.PI / 2, Math.PI / 2).name('Upper Rotate Z');
    rightLegFolder.add(human.rightLeg.lower.rotation, 'z', -Math.PI / 2, Math.PI / 2).name('Lower Rotate Z');
  }

  function onWindowResize() {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
  }

  function animate() {
    requestAnimationFrame(animate);
    controls.update();
    renderer.render(scene, camera);
  }

  init();
</script>
</body>
</html>
